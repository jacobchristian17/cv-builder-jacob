<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="document-title">Professional CV</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print {
            .no-print { display: none !important; }
            
            /* Print page setup */
            @page {
                size: A4;
                margin: 0.5in;
            }
            
            body { 
                -webkit-print-color-adjust: exact; 
                color-adjust: exact;
                font-size: 11pt !important;
                line-height: 1.3 !important;
            }
            
            /* Container adjustments */
            #cv-container {
                max-width: none !important;
                margin: 0 !important;
                padding: 0 !important;
                box-shadow: none !important;
            }
            
            /* Fix flexbox layouts for print */
            .personal_info .flex {
                display: table !important;
                width: 100% !important;
            }
            
            .personal_info .flex > div:first-child {
                display: table-cell !important;
                width: 65% !important;
                vertical-align: top !important;
                padding-right: 20pt !important;
            }
            
            .personal_info .flex > div:last-child {
                display: table-cell !important;
                width: 35% !important;
                text-align: right !important;
                vertical-align: top !important;
            }
            
            /* Experience item layouts */
            .experience-item .flex {
                display: table !important;
                width: 100% !important;
            }
            
            .experience-item .flex > div:first-child {
                display: table-cell !important;
                width: 70% !important;
                vertical-align: top !important;
                padding-right: 10pt !important;
            }
            
            .experience-item .flex > div:last-child {
                display: table-cell !important;
                width: 30% !important;
                text-align: right !important;
                vertical-align: top !important;
            }
            
            /* Skills grid fix */
            .skills .grid {
                display: table !important;
                width: 100% !important;
            }
            
            .skills .grid > div {
                display: table-cell !important;
                width: 50% !important;
                vertical-align: top !important;
                padding-right: 10pt !important;
            }
            
            /* Typography adjustments */
            h1 { font-size: 16pt !important; margin-bottom: 3pt !important; }
            h2 { font-size: 13pt !important; margin-bottom: 4pt !important; margin-top: 8pt !important; }
            h3 { font-size: 12pt !important; margin-bottom: 1pt !important; }
            h4 { font-size: 10pt !important; margin-bottom: 1pt !important; }

            p { margin-top: 0; margin-bottom: 0;}
            
            .text-xs { font-size: 8pt !important; }
            .text-sm { font-size: 9pt !important; }
            .text-base { font-size: 10pt !important; }
            .text-lg { font-size: 11pt !important; }
            .text-xl { font-size: 12pt !important; }
            .text-2xl { font-size: 14pt !important; }
            
            /* Spacing adjustments */
            .mb-8 { margin-bottom: 8pt !important; }
            .mb-6 { margin-bottom: 6pt !important; }
            .mb-4 { margin-bottom: 4pt !important; }
            .mb-2 { margin-bottom: 2pt !important; }
            .pb-6 { padding-bottom: 6pt !important; }
            .pb-2 { padding-bottom: 2pt !important; }
            .p-3 { padding: 4pt !important; }
            
            /* Page break controls */
            .personal_info { page-break-after: avoid; }
            .work_info { page-break-inside: avoid; }
            .skills { page-break-inside: avoid; }
            .education { page-break-inside: avoid; }
            .certifications { page-break-inside: avoid; }
            .other { page-break-inside: avoid; }
            .experience-item { page-break-inside: avoid; margin-bottom: 6pt !important; }
            
            /* Skill tags optimization */
            .skill_list span {
                display: inline-block !important;
                margin: 1pt 2pt 1pt 0 !important;
                padding: 2pt 4pt !important;
                /* border: 0.5pt solid #d1d5db !important; */
                border-radius: 3pt !important;
                font-size: 7pt !important;
                background-color: #e0f2fe !important;
                color: #075985 !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            /* Ensure background colors print */
            .bg-sky-100, .skill_list .bg-sky-100 {
                background-color: #e0f2fe !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            .bg-sky-50, .skill_list .bg-sky-50 {
                background-color: #f0f9ff !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            .text-sky-800 {
                color: #075985 !important;
            }
            
            /* Remove shadows and reduce spacing */
            * {
                box-shadow: none !important;
                animation: none !important;
                transition: none !important;
            }
        }
        
        .skill-category { page-break-inside: avoid; }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Loading indicator -->
    <div id="loading" class="fixed inset-0 bg-white flex items-center justify-center z-50">
        <div class="animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500"></div>
    </div>

    <!-- CV Container -->
    <div id="cv-container" class="max-w-4xl mx-auto bg-white shadow-lg my-8 p-8 hidden">
        <!-- Header Section -->
        <header class="personal_info border-b-2 border-gray-200 pb-6 mb-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <h1 id="full_name" class="name text-2xl font-bold text-gray-800 mb-2"></h1>
                    <p id="job_title" class="text-xl text-sky-600 font-medium mb-2 text-md"></p>
                    <div id="summary" class="summary text-gray-600 max-w-2xl text-sm leading-snug text-justify"></div>
                </div>
                <div class="contact-info text-right pt-4">
                    <div id="mobile" class="mobile text-gray-700 mb-1/2 text-sm"></div>
                    <div id="email" class="email text-sky-600 mb-1/2 text-sm"></div>
                    <div id="website" class="website text-sky-600 mb-1/2 text-sm"></div>
                    <div id="linkedin" class="linkedin text-sky-600 mb-1/2 text-sm"></div>
                    <div id="address" class="address text-gray-600 text-sm"></div>
                </div>
            </div>
        </header>

        <!-- Work Experience Section -->
        <section class="work_info mb-8">
            <h2 class="experience-title text-lg font-bold text-gray-800 mb-2 border-b border-gray-300 pb-2">
                Professional Experience
            </h2>
            <div id="experience-list" class="experience space-y-6"></div>
        </section>

        <!-- Skills Section -->
        <section class="skills mb-8">
            <h2 class="skills-title text-lg font-bold text-gray-800 mb-2 border-b border-gray-300 pb-2">
                Skills
            </h2>
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-semibold text-base text-gray-500 mb-1 mt-1">Core/ Technical</h3>
                    <div id="hard_skills" class="hard_skills space-y-4"></div>
                </div>
                <div>
                    <h3 class="font-semibold text-base text-gray-500 mb-1 mt-1">Soft Skills</h3>
                    <div id="soft_skills" class="soft_skills space-y-4"></div>
                </div>
            </div>
        </section>

        <!-- Education Section -->
        <section class="education mb-8">
            <h2 class="education-title text-lg font-bold text-gray-800 mb-2 border-b border-gray-300 pb-2">
                Education
            </h2>
            <div id="education-content" class="education-content">
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 id="degree" class="degree text-sm font-semibold text-sky-800"></h3>
                    <p id="school_location" class="school_location text-sm text-gray-600"></p>
                    <p id="period" class="period text-gray-500 text-xs"></p>
                </div>
            </div>
        </section>

        <!-- Certifications Section -->
        <section class="certifications mb-8">
            <h2 class="certifications-title text-lg font-bold text-gray-800 mb-2 border-b border-gray-300 pb-2">
                Certifications
            </h2>
            <div id="certifications-list" class="certifications space-y-4"></div>
        </section>

        <!-- Interests Section -->
        <section class="other mb-8">
            <h2 class="interests-title text-lg font-bold text-gray-800 mb-2 border-b border-gray-300 pb-2">
                Interests & Hobbies
            </h2>
            <div id="interest_and_hobbies" class="interest_and_hobbies space-y-4"></div>
        </section>
    </div>

    <!-- Print Controls -->
    <div class="no-print fixed bottom-4 right-4 space-y-2">
        <button onclick="printToPDF()" class="block w-full bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg shadow-lg text-sm">
            📄 Save as PDF
        </button>
        <button onclick="window.print()" class="block w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg text-sm">
            🖨️ Print CV
        </button>
    </div>

    <script>
        // Function to load and populate CV data
        async function loadCVData() {
            try {
                const response = await fetch('./data/personal_info.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                populateCV(data);
            } catch (error) {
                console.error('Error loading CV data:', error);
                document.getElementById('loading').innerHTML = `
                    <div class="text-center">
                        <h2 class="text-2xl font-bold text-red-600 mb-4">Error Loading CV Data</h2>
                        <p class="text-gray-600">${error.message}</p>
                        <p class="text-sm text-gray-500 mt-2">Please ensure the data/personal_info.json file is accessible.</p>
                    </div>
                `;
            }
        }

        // Function to populate CV with data
        function populateCV(data) {
            // Personal Info
            const personalInfo = data.personal_info;
            document.getElementById('full_name').textContent = personalInfo.name;
            document.getElementById('job_title').textContent = personalInfo.job_title;
            document.getElementById('mobile').textContent = personalInfo.mobile;
            document.getElementById('email').textContent = personalInfo.email;
            
            // Website with link
            const websiteEl = document.getElementById('website');
            if (personalInfo.website) {
                websiteEl.innerHTML = `<a href="${personalInfo.website.url}" target="_blank" class="hover:underline">${personalInfo.website.text}</a>`;
            }
            
            // LinkedIn with link
            const linkedinEl = document.getElementById('linkedin');
            if (personalInfo.linkedin) {
                linkedinEl.innerHTML = `<a href="${personalInfo.linkedin.url}" target="_blank" class="hover:underline">${personalInfo.linkedin.text}</a>`;
            }

            // Address
            const address = personalInfo.address_line;
            const fullAddress = `${address.street} ${address.barangay}, ${address.city}, ${address.country} ${address.zip}`;
            document.getElementById('address').textContent = fullAddress;

            // Work Info
            const workInfo = data.work_info;
            document.getElementById('summary').textContent = workInfo.summary;

            // Experience
            const experienceList = document.getElementById('experience-list');
            workInfo.experience.forEach((job, index) => {
                const jobEl = document.createElement('div');
                jobEl.className = `experience-item-${index} rounded-lg`;
                jobEl.innerHTML = `
                    <div class="flex flex-row justify-between items-start mb-2">
                        <div>
                            <h3 class="role text-base font-semibold text-sky-600">${job.role}</h3>
                            <p class="company text-gray-800  font-medium text-sm">${job.company}</p>
                            <p class="location text-gray-600 text-sm">${job.location}</p>
                        </div>
                        <div class="period text-gray-500 text-sm">
                            ${job.period}
                        </div>
                    </div>
                    <ul class="features mt-3 space-y-1">
                        ${job.features.map(feature => `
                            <li class="text-gray-700 text-xs"> <span class="text-sky-600">•</span> ${feature}</li>
                        `).join('')}
                    </ul>
                `;
                experienceList.appendChild(jobEl);
            });

            // Core/ Technical
            const hardSkillsEl = document.getElementById('hard_skills');
            workInfo.skills.hard_skills.forEach((skillCategory, index) => {
                const categoryEl = document.createElement('div');
                categoryEl.className = `skill-category skill-category-${index}`;
                categoryEl.innerHTML = `
                    <h4 class="category text-sm font-medium text-gray-700 mb-1">${skillCategory.category}</h4>
                    <div class="skill_list flex flex-wrap gap-1">
                        ${skillCategory.skill_list.map(skill => `
                            <span class="bg-sky-100 text-sky-800 px-2 pb-1 rounded text-xs">${skill.trim()}</span>
                        `).join('')}
                    </div>
                `;
                hardSkillsEl.appendChild(categoryEl);
            });

            // Soft Skills
            const softSkillsEl = document.getElementById('soft_skills');
            workInfo.skills.soft_skills.forEach((skillCategory, index) => {
                const categoryEl = document.createElement('div');
                categoryEl.className = `skill-category soft-skill-category-${index}`;
                categoryEl.innerHTML = `
                    <h4 class="category text-sm font-medium text-gray-800 mb-1">${skillCategory.category}</h4>
                    <div class="skill_list flex flex-wrap gap-1">
                        ${skillCategory.skill_list.map(skill => `
                            <span class="bg-sky-50 text-sky-800 px-2 py-1 rounded text-xs">${skill.trim()}</span>
                        `).join('')}
                    </div>
                `;
                softSkillsEl.appendChild(categoryEl);
            });

            // Education
            const education = data.education;
            document.getElementById('degree').textContent = education.degree;
            document.getElementById('school_location').textContent = education.school_location;
            document.getElementById('period').textContent = education.period;

            // Certifications
            const certificationsEl = document.getElementById('certifications-list');
            data.certifications.forEach((cert, index) => {
                const certEl = document.createElement('div');
                certEl.className = `certification-item-${index} bg-gray-50 p-3 rounded-lg`;
                certEl.innerHTML = `
                    <h4 class="certification_name text-sm font-semibold text-sky-800">${cert.certification_name}</h4>
                    <p class="certification_provider text-gray-600 text-sm italic">${cert.certification_provider}</p>
                    <div class="flex justify-between items-center">
                        <span class="certification_date text-gray-500 text-xs">${cert.certification_date}</span>
                        <a href="${cert.certification_link}" target="_blank" class="text-sky-600 text-xs hover:underline">View Certificate</a>
                    </div>
                `;
                certificationsEl.appendChild(certEl);
            });

            // Interests and Hobbies
            const interestsEl = document.getElementById('interest_and_hobbies');
            data.other.interest_and_hobbies.forEach((interest, index) => {
                const interestEl = document.createElement('div');
                interestEl.className = `interest-item-${index} mb-4`;
                interestEl.innerHTML = `
                    <h4 class="title text-sm font-semibold text-gray-800 mb-2">${interest.title}</h4>
                    <p class="content text-gray-600 text-xs leading-relaxed text-justify">${interest.content}</p>
                `;
                interestsEl.appendChild(interestEl);
            });

            // Update document title
            document.getElementById('document-title').textContent = `${personalInfo.name} - CV`;

            // Hide loading and show CV
            document.getElementById('loading').style.display = 'none';
            document.getElementById('cv-container').classList.remove('hidden');
        }

        // Print to PDF function
        function printToPDF() {
            // Get the person's name for the filename
            const name = document.getElementById('full_name').textContent || 'CV';
            const filename = name.replace(/\s+/g, '_') + '_CV.pdf';
            
            // Set document title for PDF
            const originalTitle = document.title;
            document.title = filename.replace('.pdf', '');
            
            // Trigger print dialog with instructions
            alert('In the print dialog:\n1. Select "Save as PDF" as destination\n2. Set filename to: ' + filename + '\n3. Ensure "Background graphics" is enabled');
            
            // Open print dialog
            window.print();
            
            // Restore original title
            setTimeout(() => {
                document.title = originalTitle;
            }, 1000);
        }

        // Load CV data when page loads
        document.addEventListener('DOMContentLoaded', loadCVData);
    </script>
</body>
</html>